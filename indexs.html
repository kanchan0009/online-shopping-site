<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ShopEasy - Buy & Sell Everything</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      /* Global Styles */
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Poppins", sans-serif;
        line-height: 1.6;
        color: #333;
        background-color: #f8f9fa;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
        padding: 0 20px;
      }

      a {
        text-decoration: none;
        color: inherit;
      }

      ul {
        list-style: none;
      }

      .btn {
        display: inline-block;
        padding: 10px 20px;
        border-radius: 5px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
        border: none;
        font-size: 16px;
      }
      
      .btn-google {
        background-color: white;
        color: #757575;
        border: 1px solid #ddd;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
        margin-top: 15px;
      }

      .btn-google:hover {
        background-color: #f8f9fa;
        border-color: #ccc;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
      }

      .google-icon {
        width: 18px;
        height: 18px;
      }

      .btn-primary {
        background-color: #4a6cf7;
        color: white;
      }

      .btn-primary:hover {
        background-color: #3a5ce5;
        transform: translateY(-2px);
      }

      .btn-secondary {
        background-color: #6c757d;
        color: white;
      }

      .btn-secondary:hover {
        background-color: #5a6268;
      }

      .btn-success {
        background-color: #28a745;
        color: white;
      }

      .btn-success:hover {
        background-color: #218838;
      }

      .btn-danger {
        background-color: #dc3545;
        color: white;
      }

      .btn-danger:hover {
        background-color: #c82333;
      }

      .btn-outline {
        background-color: transparent;
        border: 2px solid #4a6cf7;
        color: #4a6cf7;
      }

      .btn-outline:hover {
        background-color: #4a6cf7;
        color: white;
      }

      .hidden {
        display: none !important;
      }

      /* Modal Styles */
      .modal {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.5);
        display: flex;
        justify-content: center;
        align-items: center;
        z-index: 1000;
      }

      .modal-content {
        background-color: white;
        padding: 30px;
        border-radius: 10px;
        width: 90%;
        max-width: 500px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        max-height: 90vh;
        overflow-y: auto;
      }

      .modal-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 20px;
      }

      .modal-header h2 {
        font-size: 24px;
      }

      .close-modal {
        background: none;
        border: none;
        font-size: 24px;
        cursor: pointer;
        color: #777;
      }

      .form-group {
        margin-bottom: 20px;
      }

      .form-group label {
        display: block;
        margin-bottom: 5px;
        font-weight: 500;
      }

      .form-group input,
      .form-group select,
      .form-group textarea {
        width: 100%;
        padding: 10px;
        border: 1px solid #ddd;
        border-radius: 5px;
        font-size: 16px;
      }

      .form-group input:focus,
      .form-group select:focus,
      .form-group textarea:focus {
        outline: none;
        border-color: #4a6cf7;
      }

      .user-type-options {
        display: flex;
        gap: 10px;
        margin-top: 10px;
      }

      .user-type-option {
        flex: 1;
        text-align: center;
        padding: 15px;
        border: 2px solid #ddd;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .user-type-option.active {
        border-color: #4a6cf7;
        background-color: rgba(74, 108, 247, 0.1);
      }

      .user-type-option i {
        font-size: 24px;
        margin-bottom: 5px;
        display: block;
      }

      /* Payment Method Styles */
      .payment-method {
        display: flex;
        align-items: center;
        padding: 15px;
        border: 2px solid #ddd;
        border-radius: 8px;
        margin-bottom: 15px;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .payment-method:hover {
        border-color: #4a6cf7;
        background-color: #f8f9fa;
      }

      .payment-method.active {
        border-color: #4a6cf7;
        background-color: rgba(74, 108, 247, 0.05);
      }

      .payment-method input[type="radio"] {
        margin-right: 15px;
        transform: scale(1.2);
      }

      .payment-method-content {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .payment-icon {
        font-size: 24px;
        color: #4a6cf7;
        width: 40px;
        text-align: center;
      }

      .payment-details h4 {
        margin-bottom: 5px;
        font-size: 16px;
      }

      .payment-details p {
        font-size: 14px;
        color: #666;
        margin: 0;
      }

      /* Card Input Styles */
      .card-input-container {
        display: flex;
        gap: 10px;
        align-items: center;
      }

      .card-input-container input {
        flex: 1;
      }

      .card-type-icon {
        font-size: 24px;
        color: #666;
      }

      /* Order Summary Styles */
      .order-summary {
        background: #f8f9fa;
        padding: 20px;
        border-radius: 8px;
        margin: 20px 0;
      }

      .order-summary-item {
        display: flex;
        justify-content: space-between;
        margin-bottom: 10px;
        padding-bottom: 10px;
        border-bottom: 1px solid #eee;
      }

      .order-summary-total {
        display: flex;
        justify-content: space-between;
        font-size: 18px;
        font-weight: 600;
        color: #333;
        padding-top: 10px;
        border-top: 2px solid #ddd;
      }

      /* Navbar Styles */
      .navbar {
        background-color: white;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        position: sticky;
        top: 0;
        z-index: 100;
      }

      .nav-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 15px 20px;
      }

      .logo {
        font-size: 24px;
        font-weight: 700;
        color: #4a6cf7;
      }

      .logo span {
        color: #ff6b6b;
      }

      .nav-menu {
        display: flex;
        align-items: center;
        gap: 30px;
      }

      .nav-item {
        font-weight: 500;
        transition: color 0.3s ease;
      }

      .nav-item:hover {
        color: #4a6cf7;
      }

      .nav-actions {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .cart-icon {
        position: relative;
        cursor: pointer;
      }

      .cart-count {
        position: absolute;
        top: -8px;
        right: -8px;
        background-color: #ff6b6b;
        color: white;
        font-size: 12px;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .user-info {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .user-avatar {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: #4a6cf7;
        color: white;
        display: flex;
        justify-content: center;
        align-items: center;
        font-weight: 600;
      }

      .hamburger {
        display: none;
        flex-direction: column;
        cursor: pointer;
      }

      .hamburger span {
        width: 25px;
        height: 3px;
        background-color: #333;
        margin: 3px 0;
        transition: 0.3s;
      }

      /* Hero Section */
      .hero {
        background: linear-gradient(135deg, #f5f7ff 0%, #e3e9ff 100%);
        padding: 100px 0;
        text-align: center;
      }

      .hero h1 {
        font-size: 48px;
        margin-bottom: 20px;
        color: #333;
      }

      .hero h1 span {
        color: #4a6cf7;
      }

      .hero p {
        font-size: 18px;
        color: #666;
        max-width: 700px;
        margin: 0 auto 40px;
      }

      .user-type-selector {
        display: flex;
        justify-content: center;
        gap: 20px;
        margin-top: 40px;
      }

      .user-card {
        background-color: white;
        border-radius: 10px;
        padding: 30px;
        width: 300px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
      }

      .user-card:hover {
        transform: translateY(-10px);
      }

      .user-card h3 {
        font-size: 24px;
        margin-bottom: 15px;
        color: #333;
      }

      .user-card p {
        color: #666;
        margin-bottom: 20px;
      }

      .user-icon {
        font-size: 40px;
        color: #4a6cf7;
        margin-bottom: 20px;
      }

      /* Products Section */
      .products-section {
        padding: 80px 0;
      }

      .section-title {
        text-align: center;
        margin-bottom: 50px;
      }

      .section-title h2 {
        font-size: 36px;
        color: #333;
        margin-bottom: 10px;
      }

      .section-title p {
        color: #666;
        max-width: 600px;
        margin: 0 auto;
      }

      .category-filter {
        display: flex;
        justify-content: center;
        gap: 15px;
        margin-bottom: 40px;
        flex-wrap: wrap;
      }

      .category-btn {
        padding: 8px 20px;
        background-color: #f0f2ff;
        color: #4a6cf7;
        border-radius: 30px;
        font-weight: 500;
        cursor: pointer;
        transition: all 0.3s ease;
      }

      .category-btn.active {
        background-color: #4a6cf7;
        color: white;
      }

      .products-grid {
        display: grid;
        grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
        gap: 30px;
      }

      .product-card {
        background-color: white;
        border-radius: 10px;
        overflow: hidden;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        transition: transform 0.3s ease;
      }

      .product-card:hover {
        transform: translateY(-5px);
      }

      .product-image {
        height: 200px;
        width: 100%;
        object-fit: cover;
      }

      .product-info {
        padding: 20px;
      }

      .product-title {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 10px;
        color: #333;
      }

      .product-description {
        color: #666;
        font-size: 14px;
        margin-bottom: 15px;
      }

      .product-price {
        font-size: 20px;
        font-weight: 700;
        color: #4a6cf7;
        margin-bottom: 15px;
      }

      .product-seller {
        font-size: 14px;
        color: #888;
        margin-bottom: 15px;
      }

      /* Cart Page */
      .cart-section {
        padding: 80px 0;
      }

      .cart-container {
        display: grid;
        grid-template-columns: 2fr 1fr;
        gap: 30px;
      }

      .cart-items {
        background-color: white;
        border-radius: 10px;
        padding: 30px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .cart-summary {
        background-color: white;
        border-radius: 10px;
        padding: 30px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        height: fit-content;
      }

      .cart-item {
        display: flex;
        gap: 20px;
        padding: 20px 0;
        border-bottom: 1px solid #eee;
      }

      .cart-item:last-child {
        border-bottom: none;
      }

      .cart-item-image {
        width: 100px;
        height: 100px;
        object-fit: cover;
        border-radius: 5px;
      }

      .cart-item-details {
        flex: 1;
      }

      .cart-item-title {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 5px;
      }

      .cart-item-price {
        color: #4a6cf7;
        font-weight: 600;
        margin-bottom: 10px;
      }

      .cart-item-actions {
        display: flex;
        align-items: center;
        gap: 15px;
      }

      .quantity-control {
        display: flex;
        align-items: center;
        gap: 10px;
      }

      .quantity-btn {
        width: 30px;
        height: 30px;
        border-radius: 50%;
        background-color: #f0f2ff;
        border: none;
        cursor: pointer;
        display: flex;
        justify-content: center;
        align-items: center;
      }

      .quantity {
        font-weight: 600;
        min-width: 30px;
        text-align: center;
      }

      .cart-summary h3 {
        margin-bottom: 20px;
        font-size: 24px;
      }

      .summary-row {
        display: flex;
        justify-content: space-between;
        margin-bottom: 15px;
        padding-bottom: 10px;
        border-bottom: 1px solid #eee;
      }

      .summary-total {
        font-size: 20px;
        font-weight: 700;
        color: #333;
      }

      /* Contact Page */
      .contact-section {
        padding: 80px 0;
      }

      .contact-container {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 50px;
      }

      .contact-form {
        background-color: white;
        border-radius: 10px;
        padding: 30px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .contact-info {
        background-color: white;
        border-radius: 10px;
        padding: 30px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .contact-form h2,
      .contact-info h2 {
        margin-bottom: 20px;
        font-size: 24px;
      }

      .map-container {
        height: 300px;
        width: 100%;
        border-radius: 10px;
        overflow: hidden;
        margin-top: 20px;
        background-color: #eee;
        display: flex;
        justify-content: center;
        align-items: center;
        color: #666;
      }

      /* Footer */
      .footer {
        background-color: #333;
        color: white;
        padding: 60px 0 30px;
      }

      .footer-container {
        display: grid;
        grid-template-columns: repeat(4, 1fr);
        gap: 40px;
      }

      .footer-column h3 {
        font-size: 18px;
        margin-bottom: 20px;
        color: white;
      }

      .footer-links li {
        margin-bottom: 10px;
      }

      .footer-links a {
        color: #bbb;
        transition: color 0.3s ease;
      }

      .footer-links a:hover {
        color: #4a6cf7;
      }

      .social-icons {
        display: flex;
        gap: 15px;
        margin-top: 20px;
      }

      .social-icon {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        background-color: #444;
        display: flex;
        justify-content: center;
        align-items: center;
        transition: background-color 0.3s ease;
      }

      .social-icon:hover {
        background-color: #4a6cf7;
      }

      .footer-bottom {
        text-align: center;
        margin-top: 50px;
        padding-top: 20px;
        border-top: 1px solid #444;
        color: #bbb;
      }

      /* Seller Dashboard */
      .dashboard-section {
        padding: 80px 0;
      }

      .dashboard-container {
        display: grid;
        grid-template-columns: 250px 1fr;
        gap: 30px;
      }

      .dashboard-sidebar {
        background-color: white;
        border-radius: 10px;
        padding: 30px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        height: fit-content;
      }

      .dashboard-content {
        background-color: white;
        border-radius: 10px;
        padding: 30px;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
      }

      .sidebar-menu {
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .sidebar-item {
        padding: 15px;
        border-radius: 5px;
        cursor: pointer;
        transition: background-color 0.3s ease;
      }

      .sidebar-item.active {
        background-color: #f0f2ff;
        color: #4a6cf7;
        font-weight: 600;
      }

      .sidebar-item:hover:not(.active) {
        background-color: #f8f9fa;
      }

      /* Responsive Styles */
      @media (max-width: 992px) {
        .cart-container,
        .contact-container,
        .dashboard-container {
          grid-template-columns: 1fr;
        }

        .footer-container {
          grid-template-columns: repeat(2, 1fr);
        }

        .user-type-selector {
          flex-direction: column;
          align-items: center;
        }

        .user-card {
          width: 100%;
          max-width: 400px;
        }
      }

      @media (max-width: 768px) {
        .nav-menu {
          position: fixed;
          top: 70px;
          left: -100%;
          width: 100%;
          height: calc(100vh - 70px);
          background-color: white;
          flex-direction: column;
          justify-content: flex-start;
          align-items: center;
          padding-top: 50px;
          transition: left 0.3s ease;
          gap: 30px;
        }

        .nav-menu.active {
          left: 0;
        }

        .hamburger {
          display: flex;
        }

        .hero h1 {
          font-size: 36px;
        }

        .products-grid {
          grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
        }

        .footer-container {
          grid-template-columns: 1fr;
        }

        .modal-content {
          width: 95%;
          padding: 20px;
        }
      }

      @media (max-width: 576px) {
        .hero {
          padding: 60px 0;
        }

        .products-section,
        .cart-section,
        .contact-section,
        .dashboard-section {
          padding: 60px 0;
        }

        .cart-item {
          flex-direction: column;
        }

        .cart-item-image {
          width: 100%;
          height: 150px;
        }

        .payment-method-content {
          flex-direction: column;
          align-items: flex-start;
          gap: 10px;
        }
      }
    </style>
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar">
      <div class="container nav-container">
        <a href="#" class="logo">Shop<span>Easy</span></a>
        <div class="hamburger" id="hamburger">
          <span></span>
          <span></span>
          <span></span>
        </div>
        <ul class="nav-menu" id="navMenu">
          <li><a href="#home" class="nav-item" data-page="home">Home</a></li>
          <li>
            <a href="#products" class="nav-item" data-page="products">Shop</a>
          </li>
          <li><a href="#about" class="nav-item" data-page="about">About</a></li>
          <li>
            <a href="#contact" class="nav-item" data-page="contact">Contact</a>
          </li>
        </ul>
        <div class="nav-actions">
          <div class="cart-icon" id="cartIcon">
            <i class="fas fa-shopping-cart"></i>
            <span class="cart-count" id="cartCount">0</span>
          </div>
          <div class="user-info hidden" id="userInfo">
            <div class="user-avatar" id="userAvatar">U</div>
            <span id="userName">User</span>
          </div>
          <button class="btn btn-outline" id="loginBtn">Login</button>
          <button class="btn btn-primary hidden" id="logoutBtn">Logout</button>
          <button
            class="btn btn-outline hidden"
            id="refundsBtn"
            style="margin-left: 8px"
          >
            Refunds
          </button>
        </div>
      </div>
    </nav>

    <!-- Main Content Container -->
    <main id="mainContent">
      <!-- Home Page -->
      <section id="home" class="page active">
        <div class="hero">
          <div class="container">
            <h1>Buy & Sell <span>Everything</span> in One Place</h1>
            <p>
              Join thousands of buyers and sellers trading securely every day.
              Find amazing products or start your own business today!
            </p>
            <div class="user-type-selector">
              <div class="user-card">
                <div class="user-icon">
                  <i class="fas fa-shopping-bag"></i>
                </div>
                <h3>Buyer</h3>
                <p>
                  Browse thousands of products, find great deals, and shop
                  securely with buyer protection.
                </p>
                <button
                  class="btn btn-primary login-user-btn"
                  data-user-type="buyer"
                >
                  Login as Buyer
                </button>
                <button
                  class="btn btn-outline signup-user-btn"
                  data-user-type="buyer"
                >
                  Sign Up as Buyer
                </button>
              </div>
              <div class="user-card">
                <div class="user-icon">
                  <i class="fas fa-store"></i>
                </div>
                <h3>Seller</h3>
                <p>
                  Open your own shop, reach thousands of customers, and grow
                  your business with our platform.
                </p>
                <button
                  class="btn btn-primary login-user-btn"
                  data-user-type="seller"
                >
                  Login as Seller
                </button>
                <button
                  class="btn btn-outline signup-user-btn"
                  data-user-type="seller"
                >
                  Sign Up as Seller
                </button>
              </div>
            </div>
          </div>
        </div>

        <!-- Featured Products Preview -->
        <div class="products-section">
          <div class="container">
            <div class="section-title">
              <h2>Featured Products</h2>
              <p>
                Check out some of our popular items. Sign up to see the full
                catalog!
              </p>
            </div>
            <div class="products-grid" id="featuredProducts">
              <!-- Featured products will be loaded here -->
            </div>
          </div>
        </div>
      </section>

      <!-- Products Page -->
      <section id="products" class="page hidden">
        <div class="products-section">
          <div class="container">
            <div class="section-title">
              <h2>All Products</h2>
              <p>Browse through our wide selection of products</p>
            </div>
            <div class="category-filter" id="categoryFilter">
              <!-- Categories will be loaded here -->
            </div>
            <div class="products-grid" id="productsGrid">
              <!-- Products will be loaded here -->
            </div>
          </div>
        </div>
      </section>

      <!-- About Page -->
      <section id="about" class="page hidden">
        <div class="container" style="padding: 80px 0">
          <div class="section-title">
            <h2>About ShopEasy</h2>
            <p>Your trusted marketplace for buying and selling everything</p>
          </div>
          <div style="max-width: 800px; margin: 0 auto">
            <div
              style="
                background-color: white;
                padding: 40px;
                border-radius: 10px;
                box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
              "
            >
              <h3 style="margin-bottom: 20px; color: #4a6cf7">Our Mission</h3>
              <p style="margin-bottom: 20px">
                At ShopEasy, we believe that everyone should have access to a
                safe, secure, and convenient platform to buy and sell products.
                Our mission is to connect buyers and sellers in a trusted
                environment where transactions are smooth and secure.
              </p>

              <h3 style="margin-bottom: 20px; color: #4a6cf7">What We Offer</h3>
              <ul style="margin-bottom: 30px; padding-left: 20px">
                <li style="margin-bottom: 10px">
                  ‚úî Secure payment system with buyer protection
                </li>
                <li style="margin-bottom: 10px">
                  ‚úî Easy-to-use seller dashboard for managing products
                </li>
                <li style="margin-bottom: 10px">
                  ‚úî Wide range of product categories
                </li>
                <li style="margin-bottom: 10px">
                  ‚úî Customer support for all users
                </li>
                <li style="margin-bottom: 10px">
                  ‚úî Mobile-friendly platform accessible anywhere
                </li>
              </ul>

              <h3 style="margin-bottom: 20px; color: #4a6cf7">Our Team</h3>
              <p>
                We're a passionate team of developers, designers, and customer
                service professionals dedicated to making online shopping and
                selling accessible to everyone.
              </p>
            </div>
          </div>
        </div>
      </section>

      <!-- Contact Page -->
      <section id="contact" class="page hidden">
        <div class="contact-section">
          <div class="container">
            <div class="section-title">
              <h2>Contact Us</h2>
              <p>Get in touch with our team for any questions or support</p>
            </div>
            <div class="contact-container">
              <div class="contact-form">
                <h2>Send us a Message</h2>
                <form id="contactForm">
                  <div class="form-group">
                    <label for="contactName">Your Name</label>
                    <input type="text" id="contactName" required />
                  </div>
                  <div class="form-group">
                    <label for="contactEmail">Your Email</label>
                    <input type="email" id="contactEmail" required />
                  </div>
                  <div class="form-group">
                    <label for="contactSubject">Subject</label>
                    <input type="text" id="contactSubject" required />
                  </div>
                  <div class="form-group">
                    <label for="contactMessage">Message</label>
                    <textarea id="contactMessage" rows="5" required></textarea>
                  </div>
                  <button type="submit" class="btn btn-primary">
                    Send Message
                  </button>
                </form>
              </div>
              <div class="contact-info">
                <h2>Our Location</h2>
                <p><i class="fas fa-map-marker-alt"></i> Kathmandu, Nepal</p>
                <p><i class="fas fa-envelope"></i> support@shopeasy.com</p>
                <p><i class="fas fa-phone"></i> +977 1-1234567</p>
                <p><i class="fas fa-clock"></i> Mon-Fri: 9AM-6PM</p>

                <h2 style="margin-top: 30px">Visit Our Office</h2>
                <div class="map-container">
                  <div id="map" style="width: 100%; height: 100%">
                    <p>üìç Kathmandu, Nepal<br />Google Maps Location</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Cart Page -->
      <section id="cart" class="page hidden">
        <div class="cart-section">
          <div class="container">
            <h1 style="text-align: center; margin-bottom: 40px">
              Your Shopping Cart
            </h1>
            <div class="cart-container">
              <div class="cart-items" id="cartItems">
                <!-- Cart items will be loaded here -->
                <p style="text-align: center; padding: 40px">
                  Your cart is empty
                </p>
              </div>
              <div class="cart-summary">
                <h3>Order Summary</h3>
                <div class="summary-row">
                  <span>Subtotal:</span>
                  <span id="cartSubtotal">Rs0.00</span>
                </div>
                <div class="summary-row">
                  <span>Shipping:</span>
                  <span id="cartShipping">Rs0.00</span>
                </div>
                <div class="summary-row">
                  <span>Tax:</span>
                  <span id="cartTax">Rs0.00</span>
                </div>
                <div class="summary-row summary-total">
                  <span>Total:</span>
                  <span id="cartTotal">Rs0.00</span>
                </div>
                <button
                  class="btn btn-primary"
                  style="width: 100%; margin-top: 20px"
                  id="checkoutBtn"
                >
                  Proceed to Checkout
                </button>
                <button
                  class="btn btn-outline"
                  style="width: 100%; margin-top: 10px"
                  id="continueShoppingBtn"
                >
                  Continue Shopping
                </button>
              </div>
            </div>
          </div>
        </div>
      </section>

      <!-- Refunds Page -->
      <section id="refunds" class="page hidden">
        <div class="container" style="padding: 60px 0">
          <h1 style="text-align: center; margin-bottom: 30px">
            Your Orders & Refunds
          </h1>
          <div
            id="ordersList"
            style="
              max-width: 900px;
              margin: 0 auto;
              background: white;
              padding: 20px;
              border-radius: 8px;
              box-shadow: 0 4px 12px rgba(0, 0, 0, 0.06);
            "
          >
            <!-- Orders will be rendered here -->
          </div>
        </div>
      </section>

      <!-- Account Switch Page -->
      <section id="accountSwitchPage" class="page hidden">
        <div class="container" style="padding: 80px 0">
          <h1 style="text-align: center; margin-bottom: 30px">
            Account / Role Switcher
          </h1>
          <div
            style="
              max-width: 600px;
              margin: 0 auto;
              background: white;
              padding: 30px;
              border-radius: 10px;
              box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            "
          >
            <div class="form-group">
              <label for="accountPageSelect">Select Account</label>
              <select
                id="accountPageSelect"
                style="
                  width: 100%;
                  padding: 10px;
                  border: 1px solid #ddd;
                  border-radius: 6px;
                  font-size: 16px;
                "
              ></select>
            </div>
            <div class="form-group">
              <label>Act As</label>
              <div style="display: flex; gap: 10px; margin-top: 8px">
                <label style="display: flex; align-items: center; gap: 8px"
                  ><input type="radio" name="accountRole" value="buyer" />
                  Buyer</label
                >
                <label style="display: flex; align-items: center; gap: 8px"
                  ><input type="radio" name="accountRole" value="seller" />
                  Seller</label
                >
              </div>
            </div>
            <div
              style="
                display: flex;
                gap: 10px;
                justify-content: flex-end;
                margin-top: 20px;
              "
            >
              <button class="btn btn-outline" id="cancelSwitchBtn">
                Cancel
              </button>
              <button class="btn btn-primary" id="applySwitchBtn">Apply</button>
            </div>
          </div>
        </div>
      </section>

      <!-- Seller Dashboard -->
      <section id="sellerDashboard" class="page hidden">
        <div class="dashboard-section">
          <div class="container">
            <h1 style="text-align: center; margin-bottom: 40px">
              Seller Dashboard
            </h1>
            <div class="dashboard-container">
              <div class="dashboard-sidebar">
                <div class="sidebar-menu">
                  <div class="sidebar-item active" data-dashboard="overview">
                    Overview
                  </div>
                  <div class="sidebar-item" data-dashboard="products">
                    My Products
                  </div>
                  <div class="sidebar-item" data-dashboard="addProduct">
                    Add New Product
                  </div>
                  <div class="sidebar-item" data-dashboard="orders">Orders</div>
                  <div class="sidebar-item" data-dashboard="analytics">
                    Analytics
                  </div>
                </div>
              </div>
              <div class="dashboard-content">
                <div id="dashboardContent">
                  <!-- Dashboard content will be loaded here -->
                  <h2>Welcome to Your Seller Dashboard</h2>
                  <p>
                    Use the menu to manage your products and view your sales
                    analytics.
                  </p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <!-- Footer -->
    <footer class="footer">
      <div class="container footer-container">
        <div class="footer-column">
          <h3>ShopEasy</h3>
          <p>
            Your trusted marketplace for buying and selling everything online.
            Safe, secure, and convenient.
          </p>
          <div class="social-icons">
            <a href="#" class="social-icon"
              ><i class="fab fa-facebook-f"></i
            ></a>
            <a href="#" class="social-icon"><i class="fab fa-twitter"></i></a>
            <a href="#" class="social-icon"><i class="fab fa-instagram"></i></a>
            <a href="#" class="social-icon"
              ><i class="fab fa-linkedin-in"></i
            ></a>
          </div>
        </div>
        <div class="footer-column">
          <h3>Quick Links</h3>
          <ul class="footer-links">
            <li><a href="#home" data-page="home">Home</a></li>
            <li><a href="#products" data-page="products">Shop</a></li>
            <li><a href="#about" data-page="about">About Us</a></li>
            <li><a href="#contact" data-page="contact">Contact</a></li>
          </ul>
        </div>
        <div class="footer-column">
          <h3>Support</h3>
          <ul class="footer-links">
            <li><a href="#">Help Center</a></li>
            <li><a href="#">FAQs</a></li>
            <li><a href="#">Privacy Policy</a></li>
            <li><a href="#">Terms of Service</a></li>
          </ul>
        </div>
        <div class="footer-column">
          <h3>Contact Info</h3>
          <ul class="footer-links">
            <li><i class="fas fa-map-marker-alt"></i> Kathmandu, Nepal</li>
            <li><i class="fas fa-envelope"></i> info@shopeasy.com</li>
            <li><i class="fas fa-phone"></i> +977 1-1234567</li>
          </ul>
        </div>
      </div>
      <div class="footer-bottom">
        <p>&copy; 2023 ShopEasy. All rights reserved.</p>
      </div>
    </footer>

    <!-- Login Modal -->
    <div class="modal hidden" id="loginModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Login</h2>
          <button class="close-modal" id="closeLoginModal">&times;</button>
        </div>
        <form id="loginForm">
          <div class="form-group">
            <label>Select Account (or enter credentials below)</label>
            <div
              id="availableAccountsList"
              style="
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
                gap: 10px;
                margin-bottom: 20px;
              "
            >
              <!-- Available accounts will be rendered here -->
            </div>
          </div>
          <div class="form-group">
            <label for="loginEmail">Email Address</label>
            <input type="email" id="loginEmail" required />
          </div>
          <div class="form-group">
            <label for="loginPassword">Password</label>
            <input type="password" id="loginPassword" required />
          </div>
          <div class="form-group">
            <label>Login as:</label>
            <div class="user-type-options">
              <div class="user-type-option active" data-user-type="buyer">
                <i class="fas fa-shopping-bag"></i>
                <span>Buyer</span>
              </div>
              <div class="user-type-option" data-user-type="seller">
                <i class="fas fa-store"></i>
                <span>Seller</span>
              </div>
            </div>
          </div>
          <button type="submit" class="btn btn-primary" style="width: 100%">
            Login
          </button>
        </form>
        <p style="text-align: center; margin-top: 15px">
          Don't have an account?
          <a href="#" id="showSignupFromLogin">Sign up here</a>
        </p>
        <button type="button" class="btn btn-google" id="signupGoogleBtn" style="width: 100%">
            <img src="https://img.freepik.com/premium-vector/google-app-icon_1273375-1571.jpg?semt=ais_hybrid&w=740&q=80" alt="G" class="google-icon">
            Sign up with Google
        </button>
      </div>
    </div>


    <!-- Signup Modal -->
    <div class="modal hidden" id="signupModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Sign Up</h2>
          <button class="close-modal" id="closeSignupModal">&times;</button>
        </div>
        <form id="signupForm">
          <div class="form-group">
            <label for="signupName">Full Name</label>
            <input type="text" id="signupName" required />
          </div>
          <div class="form-group">
            <label for="signupEmail">Email Address</label>
            <input type="email" id="signupEmail" required />
          </div>
          <div class="form-group">
            <label for="signupPassword">Password</label>
            <input type="password" id="signupPassword" required />
          </div>
          <div class="form-group">
            <label for="confirmPassword">Confirm Password</label>
            <input type="password" id="confirmPassword" required />
          </div>
          <div class="form-group">
            <label>Sign up as:</label>
            <div class="user-type-options">
              <div class="user-type-option active" data-user-type="buyer">
                <i class="fas fa-shopping-bag"></i>
                <span>Buyer</span>
              </div>
              <div class="user-type-option" data-user-type="seller">
                <i class="fas fa-store"></i>
                <span>Seller</span>
              </div>
            </div>
          </div>
          <button type="submit" class="btn btn-primary" style="width: 100%">
            Create Account
          </button>
        </form>
        <p style="text-align: center; margin-top: 15px">
          Already have an account?
          <a href="#" id="showLoginFromSignup">Login here</a>
        </p>
        <button type="button" class="btn btn-google" id="loginGoogleBtn" style="width: 100%">
            <img src="https://img.freepik.com/premium-vector/google-app-icon_1273375-1571.jpg?semt=ais_hybrid&w=740&q=80" alt="G" class="google-icon">
            Sign in with Google
        </button>
        
      </div>
    </div>

    <!-- Checkout Modal -->
    <div class="modal hidden" id="checkoutModal">
      <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
          <h2>Checkout</h2>
          <button class="close-modal" id="closeCheckoutModal">&times;</button>
        </div>
        <div class="modal-body">
          <div id="paymentSelection">
            <p style="margin-bottom: 15px; font-weight: 500;">Select payment method:</p>
            
            <div class="payment-method" id="codPaymentOption">
              <input type="radio" id="codPayment" name="paymentMethod" value="cod" checked>
              <div class="payment-method-content">
                <div class="payment-icon">
                  <i class="fas fa-money-bill-wave"></i>
                </div>
                <div class="payment-details">
                  <h4>Cash on Delivery</h4>
                  <p>Pay when you receive your order</p>
                </div>
              </div>
            </div>
            
            <div class="payment-method" id="onlinePaymentOption">
              <input type="radio" id="onlinePayment" name="paymentMethod" value="online">
              <div class="payment-method-content">
                <div class="payment-icon">
                  <i class="fas fa-credit-card"></i>
                </div>
                <div class="payment-details">
                  <h4>Online Payment</h4>
                  <p>Pay securely with your card</p>
                </div>
              </div>
            </div>
            
            <!-- Delivery Information Form -->
            <div id="deliveryInfoForm">
              <h3 style="margin-bottom: 15px; font-size: 18px; padding-top: 15px; border-top: 1px solid #eee;">Delivery Information</h3>
              <div class="form-group">
                <label for="deliveryFullName">Full Name</label>
                <input type="text" id="deliveryFullName" required>
              </div>
              <div class="form-group">
                <label for="deliveryPhone">Phone Number</label>
                <input type="tel" id="deliveryPhone" placeholder="+977 98XXXXXXXX" required>
              </div>
              <div class="form-group">
                <label for="deliveryAddress">Full Address</label>
                <textarea id="deliveryAddress" rows="3" placeholder="Street address, ward number, etc." required></textarea>
              </div>
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                <div class="form-group">
                  <label for="deliveryCity">City</label>
                  <input type="text" id="deliveryCity" required>
                </div>
                <div class="form-group">
                  <label for="deliveryZipCode">Zip Code</label>
                  <input type="text" id="deliveryZipCode" required>
                </div>
              </div>
            </div>
            
            <!-- Order Summary -->
            <div class="order-summary">
              <h4 style="margin-bottom: 15px;">Order Summary</h4>
              <div class="order-summary-item">
                <span>Subtotal:</span>
                <span id="checkoutSubtotal">Rs0.00</span>
              </div>
              <div class="order-summary-item">
                <span>Shipping:</span>
                <span id="checkoutShipping">Rs0.00</span>
              </div>
              <div class="order-summary-item">
                <span>Tax:</span>
                <span id="checkoutTax">Rs0.00</span>
              </div>
              <div class="order-summary-total">
                <span>Total:</span>
                <span id="checkoutTotal">Rs0.00</span>
              </div>
            </div>
          </div>
        </div>
        <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
          <button class="btn btn-outline" id="checkoutCancelBtn">Cancel</button>
          <button class="btn btn-primary" id="proceedToPaymentBtn">Proceed</button>
        </div>
      </div>
    </div>

    <!-- Online Payment Modal -->
    <div class="modal hidden" id="onlinePaymentModal">
      <div class="modal-content" style="max-width: 600px;">
        <div class="modal-header">
          <h2>Online Payment</h2>
          <button class="close-modal" id="closeOnlinePaymentModal">&times;</button>
        </div>
        <div class="modal-body">
          <form id="onlinePaymentForm">
            <!-- Payment Method Selection -->
            <div style="margin-bottom: 25px;">
              <h3 style="margin-bottom: 15px; font-size: 18px;">Payment Method</h3>
              <div style="display: flex; gap: 15px; margin-bottom: 20px;">
                <div class="payment-method active" style="flex: 1;">
                  <div class="payment-method-content">
                    <div class="payment-icon">
                      <i class="fab fa-cc-visa"></i>
                    </div>
                    <div class="payment-details">
                      <h4>Credit/Debit Card</h4>
                      <p>Visa, MasterCard, etc.</p>
                    </div>
                  </div>
                </div>
              </div>
              
              <!-- Card Details -->
              <div class="form-group">
                <label for="cardNumber">Card Number</label>
                <div class="card-input-container">
                  <input type="text" id="cardNumber" placeholder="1234 5678 9012 3456" required maxlength="19">
                  <div class="card-type-icon">
                    <i class="fab fa-cc-visa"></i>
                  </div>
                </div>
              </div>
              
              <div style="display: grid; grid-template-columns: 2fr 1fr; gap: 15px;">
                <div class="form-group">
                  <label for="cardExpiry">Expiry Date (MM/YY)</label>
                  <input type="text" id="cardExpiry" placeholder="12/25" required maxlength="5">
                </div>
                <div class="form-group">
                  <label for="cardCVV">CVV</label>
                  <input type="password" id="cardCVV" placeholder="123" required maxlength="4">
                </div>
              </div>
              
              <div class="form-group">
                <label for="cardName">Name on Card</label>
                <input type="text" id="cardName" placeholder="John Doe" required>
              </div>
            </div>
            
            <!-- Billing Information -->
            <div style="margin-bottom: 25px;">
              <h3 style="margin-bottom: 15px; font-size: 18px;">Billing Information</h3>
              <div class="form-group">
                <label for="billingAddress">Billing Address</label>
                <textarea id="billingAddress" rows="2" required></textarea>
              </div>
              
              <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-bottom: 20px;">
                <div class="form-group">
                  <label for="billingCity">City</label>
                  <input type="text" id="billingCity" required>
                </div>
                <div class="form-group">
                  <label for="billingZipCode">Zip Code</label>
                  <input type="text" id="billingZipCode" required>
                </div>
              </div>
            </div>
            
            <!-- Order Summary -->
            <div class="order-summary">
              <h4 style="margin-bottom: 15px;">Order Summary</h4>
              <div class="order-summary-item">
                <span>Items:</span>
                <span id="paymentSubtotal">Rs0.00</span>
              </div>
              <div class="order-summary-item">
                <span>Shipping:</span>
                <span id="paymentShipping">Rs0.00</span>
              </div>
              <div class="order-summary-item">
                <span>Tax:</span>
                <span id="paymentTax">Rs0.00</span>
              </div>
              <div class="order-summary-total">
                <span>Total Amount:</span>
                <span id="paymentTotal">Rs0.00</span>
              </div>
            </div>
            
            <div style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
              <p style="font-size: 14px; color: #666; margin: 0;">
                <i class="fas fa-lock" style="color: #28a745; margin-right: 5px;"></i>
                Your payment is secure and encrypted. We never store your card details.
              </p>
            </div>
          </form>
        </div>
        <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px;">
          <button class="btn btn-outline" id="backToCheckoutBtn">Back</button>
          <button class="btn btn-primary" id="confirmPaymentBtn">Pay Now</button>
        </div>
      </div>
    </div>

    <!-- Refund Modal -->
    <div class="modal hidden" id="refundModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Request Refund</h2>
          <button class="close-modal" id="closeRefundModal">&times;</button>
        </div>
        <div class="modal-body">
          <p>Please describe the reason for refund/return:</p>
          <textarea
            id="refundReason"
            rows="5"
            style="
              width: 100%;
              padding: 8px;
              border: 1px solid #ddd;
              border-radius: 6px;
            "
          ></textarea>
        </div>
        <div
          style="
            display: flex;
            gap: 10px;
            justify-content: flex-end;
            margin-top: 12px;
          "
        >
          <button class="btn btn-outline" id="refundCancelBtn">Cancel</button>
          <button class="btn btn-primary" id="refundSubmitBtn">Submit Refund Request</button>
        </div>
      </div>
    </div>

    <!-- Add Product Modal (for sellers) -->
    <div class="modal hidden" id="addProductModal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>Add New Product</h2>
          <button class="close-modal" id="closeAddProductModal">&times;</button>
        </div>
        <form id="addProductForm">
          <div class="form-group">
            <label for="productName">Product Name</label>
            <input type="text" id="productName" required />
          </div>
          <div class="form-group">
            <label for="productDescription">Description</label>
            <textarea id="productDescription" rows="3" required></textarea>
          </div>
          <div class="form-group">
            <label for="productPrice">Price (USD)</label>
            <input
              type="number"
              id="productPrice"
              min="0"
              step="0.01"
              required
            />
          </div>
          <div class="form-group">
            <label for="productCategory">Category</label>
            <select id="productCategory" required>
              <option value="">Select Category</option>
              <option value="electronics">Electronics</option>
              <option value="fashion">Fashion</option>
              <option value="home">Home & Garden</option>
              <option value="sports">Sports</option>
              <option value="books">Books</option>
              <option value="other">Other</option>
            </select>
          </div>
          <div class="form-group">
            <label for="productImage">Image URL</label>
            <input
              type="text"
              id="productImage"
              placeholder="https://example.com/image.jpg"
              required
            />
          </div>
          <button type="submit" class="btn btn-success" style="width: 100%">
            Add Product
          </button>
        </form>
      </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

    <script>
       const SUPABASE_URL = 'https://kwlbdyxvhhsvbqbqcqly.supabase.co';
      const SUPABASE_KEY = 'sb_publishable_apRZ400pD9f4sSW_6U2nDw_nNTu_jJW'; // Publishable Key
      const SUPABASE_SECRET_KEY = 'sb_secret_MbiQkSP5YMogjkv5Pm8Dzg_WS3FnSFB'; // Secret Key (Service Role) - WARNING: EXPOSED TO CLIENT
      // NOTE: Using the secret key on the client side is a security risk as it bypasses Row Level Security.

      // Initialize Supabase Client
      let supabaseClient = null;
      try {
        if (typeof supabase !== 'undefined') {
          supabaseClient = supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
          console.log('Supabase initialized successfully');
        } else {
          console.error('Supabase SDK not loaded');
        }
      } catch (error) {
        console.error('Error initializing Supabase:', error);
      }

      // Google Auth Handler
      async function handleGoogleLogin(role) {
        if (!supabaseClient) {
            return;
        }
        try {
            // DEBUG: Show user exactly what URL is being used
            const redirectUrl = window.location.origin; // e.g., http://localhost:5500
            console.log("Using Redirect URL:", redirectUrl);

            const { data, error } = await supabaseClient.auth.signInWithOAuth({
                provider: 'google',
                options: {
                    // queryParams: { access_type: 'offline', prompt: 'consent' }, // Removed to simplify
                    redirectTo: redirectUrl
                }
            });
            
            if (error) throw error;
            
            // Store intended role to be used after redirect
            localStorage.setItem('pending_role', role);
            
        } catch (error) {
            console.error("Google Login Error:", error);
            alert("Error signing in with Google: " + error.message);
        }
      }

      // Add listeners for Google buttons
      const loginGoogleBtn = document.getElementById('loginGoogleBtn');
      const signupGoogleBtn = document.getElementById('signupGoogleBtn');

      if (loginGoogleBtn) {
        loginGoogleBtn.addEventListener('click', () => {
            // Check active role tab in login modal
            const activeTab = document.querySelector('#loginForm .user-type-option.active');
            const role = activeTab ? activeTab.dataset.userType : 'buyer';
            handleGoogleLogin(role);
        });
      }

      if (signupGoogleBtn) {
        signupGoogleBtn.addEventListener('click', () => {
            // Check active role tab in signup modal
            const activeTab = document.querySelector('#signupForm .user-type-option.active');
            const role = activeTab ? activeTab.dataset.userType : 'buyer';
            handleGoogleLogin(role);
        });
      }

      // Handle Auth State Changes and Session Recovery
      async function setupSupabaseAuthListener() {
        if (!supabaseClient) return;

        // Detect if we are returning from a redirect (code or token in URL)
        const params = new URLSearchParams(window.location.search);
        const hasHashParams = window.location.hash.includes('access_token');
        const hasError = params.has('error') || window.location.hash.includes('error');

        if (hasError) {
             const errorDescription = params.get('error_description') || "Login failed.";
             alert("Google Login Error: " + errorDescription);
             return;
        }

        if (params.has('code') || hasHashParams) {
             window.authCheckInProgress = true; // Flag to prevent init from overriding routing
             // Show a temporary loading state
             const loader = document.createElement('div');
             loader.id = 'auth-loader';
             loader.style.cssText = 'position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(255,255,255,0.95);z-index:10000;display:flex;flex-direction:column;justify-content:center;align-items:center;font-family:sans-serif;';
             loader.innerHTML = '<div style="font-size:24px;color:#4a6cf7;margin-bottom:10px;font-weight:bold">Verifying Google Login...</div><div style="color:#666">Please wait while we log you in.</div>';
             document.body.appendChild(loader);
        }

        // Check for existing session on load (handles redirect return)
        const { data: { session }, error } = await supabaseClient.auth.getSession();
        
        // Clear flag so other parts of app know we are done checking
        window.authCheckInProgress = false;
        
        if (error) {
            console.error("Supabase Session Error:", error);
            const loader = document.getElementById('auth-loader');
            if (loader) {
                loader.innerHTML = '<div style="color:red;font-size:18px">Login Verification Failed</div>';
                setTimeout(() => loader.remove(), 2000);
            }
        } else {
             // Remove loader if it exists (add slight delay for UX if session found quickly)
             const loader = document.getElementById('auth-loader');
             if (loader) {
                setTimeout(() => loader.remove(), 500); // 500ms delay to ensure message is seen
             }
        }

        if (session) {
            handleAuthenticatedUser(session.user);
        }

        // Listen for changes (sign in, sign out)
        supabaseClient.auth.onAuthStateChange((event, session) => {
            if (event === 'SIGNED_IN' && session) {
                // Determine if we need to handle this as a fresh login
                // Prevents infinite loops or re-handling if already logged in
                if (!state.currentUser || state.currentUser.id !== session.user.id) {
                    handleAuthenticatedUser(session.user);
                }
            } else if (event === 'SIGNED_OUT') {
                console.log("Supabase: Signed out");
            }
        });
      }

      function handleAuthenticatedUser(sbUser) {
        console.log("Authenticated User:", sbUser);
        
        // Recover the intended role
        const intendedRole = localStorage.getItem('pending_role') || 'buyer';
        
        // Map Supabase user to App user structure
        // we use the email part as the name if metadata name is missing
        const userName = sbUser.user_metadata.full_name || sbUser.user_metadata.name || sbUser.email.split('@')[0];
        
        const appUser = {
            id: sbUser.id, // Use Supabase UUID
            name: userName,
            email: sbUser.email,
            type: intendedRole, // Assign the selected role
            activeRole: intendedRole
        };

        // Update App State
        state.currentUser = appUser;
        saveUserToStorage(); // Save to app's local storage mechanism
        loadCartFromStorage();
        updateUIAfterLogin();
        
        // Clear pending role
        localStorage.removeItem('pending_role');

        // Redirect based on role
        if (intendedRole === 'seller') {
            showPage('sellerDashboard');
        } else {
            showPage('products');
        }
        
        // Close any open modals
        document.querySelectorAll('.modal').forEach(m => m.classList.add('hidden'));
        
        // Only alert if we just loaded the page (basic check)
        // A better way would be using a 'just_logged_in' flag in sessionStorage
        if (!sessionStorage.getItem('welcome_shown')) {
             alert(`Successfully logged in as ${userName} (${intendedRole})`);
             sessionStorage.setItem('welcome_shown', 'true');
        }
      }
      
      // Currency conversion (USD -> RS)
      const CURRENCY = {
        code: "RS",
        symbol: "Rs ",
        // Conversion rate: 1 USD -> X RS (adjust as needed)
        rate: 132.0,
      };

      function formatRS(usdAmount) {
        const rs = usdAmount * CURRENCY.rate;
        return `${CURRENCY.symbol}${rs.toFixed(2)}`;
      }

      // keep last computed cart totals (in USD) for checkout
      window.lastCartTotals = { subtotal: 0, shipping: 0, tax: 0, total: 0 };

      // Application State
      const state = {
        currentUser: null,
        products: [
          {
            id: 1,
            name: "Wireless Bluetooth Headphones",
            description:
              "Noise cancelling headphones with 30-hour battery life",
            price: 89.99,
            category: "electronics",
            image:
              "https://images.unsplash.com/photo-1505740420928-5e560c06d30e?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            seller: "TechStore",
          },
          {
            id: 2,
            name: "Running Shoes",
            description: "Lightweight running shoes with cushioned soles",
            price: 129.99,
            category: "sports",
            image:
              "https://images.unsplash.com/photo-1542291026-7eec264c27ff?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            seller: "SportsGear",
          },
          {
            id: 3,
            name: "Coffee Maker",
            description: "Programmable coffee maker with thermal carafe",
            price: 149.99,
            category: "home",
            image:
              "https://images.unsplash.com/photo-1495474472287-4d71bcdd2085?ixlib=rb-4.0.3&auto=format&fit=crop&w-800&q=80",
            seller: "HomeEssentials",
          },
          {
            id: 4,
            name: "Smart Watch",
            description: "Fitness tracking smartwatch with heart rate monitor",
            price: 199.99,
            category: "electronics",
            image:
              "https://images.unsplash.com/photo-1523275335684-37898b6baf30?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            seller: "TechStore",
          },
          {
            id: 5,
            name: "Leather Jacket",
            description: "Genuine leather jacket with multiple pockets",
            price: 179.99,
            category: "fashion",
            image:
              "https://images.unsplash.com/photo-1551028719-00167b16eac5?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            seller: "FashionHub",
          },
          {
            id: 6,
            name: "Yoga Mat",
            description: "Non-slip yoga mat with carrying strap",
            price: 34.99,
            category: "sports",
            image:
              "https://images.unsplash.com/photo-1599901860904-17e6ed7083a0?ixlib=rb-4.0.3&auto=format&fit=crop&w=800&q=80",
            seller: "SportsGear",
          },
        ],
        cart: [],
        categories: [
          "all",
          "electronics",
          "fashion",
          "home",
          "sports",
          "books",
        ],
        users: [
          // Predefined users for testing
          {
            id: 1,
            name: "Buyer User",
            email: "buyer@test.com",
            password: "123456",
            type: "buyer",
          },
          {
            id: 2,
            name: "Seller User",
            email: "seller@test.com",
            password: "123456",
            type: "seller",
          },
        ],
      };

      // DOM Elements
      const dom = {
        // Pages
        pages: document.querySelectorAll(".page"),
        mainContent: document.getElementById("mainContent"),

        // Navigation
        navItems: document.querySelectorAll(".nav-item"),
        hamburger: document.getElementById("hamburger"),
        navMenu: document.getElementById("navMenu"),

        // User Interface
        loginBtn: document.getElementById("loginBtn"),
        logoutBtn: document.getElementById("logoutBtn"),
        userInfo: document.getElementById("userInfo"),
        userName: document.getElementById("userName"),
        userAvatar: document.getElementById("userAvatar"),
        cartIcon: document.getElementById("cartIcon"),
        cartCount: document.getElementById("cartCount"),
        // Account switch page elements
        accountPageSelect: document.getElementById("accountPageSelect"),
        applySwitchBtn: null,
        cancelSwitchBtn: null,

        // Modals
        loginModal: document.getElementById("loginModal"),
        signupModal: document.getElementById("signupModal"),
        addProductModal: document.getElementById("addProductModal"),
        checkoutModal: document.getElementById("checkoutModal"),
        onlinePaymentModal: document.getElementById("onlinePaymentModal"),
        refundsBtn: document.getElementById("refundsBtn"),
        ordersList: document.getElementById("ordersList"),
        refundModal: document.getElementById("refundModal"),
        refundReason: document.getElementById("refundReason"),
        refundSubmitBtn: document.getElementById("refundSubmitBtn"),
        refundCancelBtn: document.getElementById("refundCancelBtn"),
        closeLoginModal: document.getElementById("closeLoginModal"),
        closeSignupModal: document.getElementById("closeSignupModal"),
        closeAddProductModal: document.getElementById("closeAddProductModal"),
        closeCheckoutModal: document.getElementById("closeCheckoutModal"),
        closeOnlinePaymentModal: document.getElementById("closeOnlinePaymentModal"),
        showSignupFromLogin: document.getElementById("showSignupFromLogin"),
        showLoginFromSignup: document.getElementById("showLoginFromSignup"),

        // Forms
        loginForm: document.getElementById("loginForm"),
        signupForm: document.getElementById("signupForm"),
        addProductForm: document.getElementById("addProductForm"),
        contactForm: document.getElementById("contactForm"),
        onlinePaymentForm: document.getElementById("onlinePaymentForm"),

        // Product Display
        featuredProducts: document.getElementById("featuredProducts"),
        productsGrid: document.getElementById("productsGrid"),
        categoryFilter: document.getElementById("categoryFilter"),

        // Cart
        cartItems: document.getElementById("cartItems"),
        cartSubtotal: document.getElementById("cartSubtotal"),
        cartShipping: document.getElementById("cartShipping"),
        cartTax: document.getElementById("cartTax"),
        cartTotal: document.getElementById("cartTotal"),
        checkoutBtn: document.getElementById("checkoutBtn"),
        continueShoppingBtn: document.getElementById("continueShoppingBtn"),

        // Checkout
        proceedToPaymentBtn: document.getElementById("proceedToPaymentBtn"),
        backToCheckoutBtn: document.getElementById("backToCheckoutBtn"),
        confirmPaymentBtn: document.getElementById("confirmPaymentBtn"),
        checkoutCancelBtn: document.getElementById("checkoutCancelBtn"),
        codPaymentOption: document.getElementById("codPaymentOption"),
        onlinePaymentOption: document.getElementById("onlinePaymentOption"),

        // Dashboard
        dashboardContent: document.getElementById("dashboardContent"),
        sidebarItems: document.querySelectorAll(".sidebar-item"),
      };

      // Initialize Application
      function init() {
        loadUserFromStorage();
        renderFeaturedProducts();
        renderCategories();
        renderProducts();
        updateCartDisplay();
        setupEventListeners();

        // Mount function - check if user is logged in
        if (!state.currentUser) {
          showPage("home");
        } else {
          // User is logged in, show appropriate page
          if (state.currentUser.type === "seller") {
            showPage("sellerDashboard");
          } else {
            showPage("products");
          }
        }
      }
      

      // Event Listeners Setup
      function setupEventListeners() {
        // Navigation
        dom.navItems.forEach((item) => {
          item.addEventListener("click", (e) => {
            e.preventDefault();
            const page = item.getAttribute("data-page");

            // Check authentication for protected pages
            if (page === "products" || page === "cart") {
              if (!state.currentUser) {
                showModal("login");
                return;
              }
            }

            showPage(page);
            if (window.innerWidth <= 768) {
              dom.navMenu.classList.remove("active");
            }
          });
        });

        // Footer links
        document.querySelectorAll(".footer-links a").forEach((link) => {
          link.addEventListener("click", (e) => {
            if (link.hasAttribute("data-page")) {
              e.preventDefault();
              const page = link.getAttribute("data-page");

              if (page === "products" || page === "cart") {
                if (!state.currentUser) {
                  showModal("login");
                  return;
                }
              }

              showPage(page);
            }
          });
        });

        // User type selection on home page
        document.querySelectorAll(".login-user-btn").forEach((btn) => {
          btn.addEventListener("click", () => {
            const userType = btn.getAttribute("data-user-type");
            selectUserType(userType);
            showModal("login");
          });
        });

        document.querySelectorAll(".signup-user-btn").forEach((btn) => {
          btn.addEventListener("click", () => {
            const userType = btn.getAttribute("data-user-type");
            selectUserType(userType);
            showModal("signup");
          });
        });

        // Hamburger menu
        dom.hamburger.addEventListener("click", () => {
          dom.navMenu.classList.toggle("active");
        });

        // Cart icon
        dom.cartIcon.addEventListener("click", () => {
          if (!state.currentUser) {
            showModal("login");
            return;
          }
          showPage("cart");
        });

        // Login/Logout
        dom.loginBtn.addEventListener("click", () => showModal("login"));
        // Open account switch page instead of immediate logout
        dom.logoutBtn.addEventListener("click", () => {
          showPage("accountSwitchPage");
          // wire buttons on the account page
          dom.applySwitchBtn = document.getElementById("applySwitchBtn");
          dom.cancelSwitchBtn = document.getElementById("cancelSwitchBtn");
          setupAccountPageListeners();
          renderAccountPageOptions();
        });

        // Modal close buttons
        dom.closeLoginModal.addEventListener("click", () => hideModal("login"));
        dom.closeSignupModal.addEventListener("click", () =>
          hideModal("signup")
        );
        dom.closeAddProductModal.addEventListener("click", () =>
          hideModal("addProduct")
        );
        dom.closeCheckoutModal.addEventListener("click", () =>
          hideModal("checkout")
        );
        dom.closeOnlinePaymentModal.addEventListener("click", () =>
          hideModal("onlinePayment")
        );

        // Switch between login and signup modals
        dom.showSignupFromLogin.addEventListener("click", (e) => {
          e.preventDefault();
          hideModal("login");
          showModal("signup");
        });

        dom.showLoginFromSignup.addEventListener("click", (e) => {
          e.preventDefault();
          hideModal("signup");
          showModal("login");
        });

        // Forms
        dom.loginForm.addEventListener("submit", handleLogin);
        dom.signupForm.addEventListener("submit", handleSignup);
        dom.addProductForm.addEventListener("submit", handleAddProduct);
        dom.contactForm.addEventListener("submit", handleContact);

        // Cart actions
        dom.checkoutBtn.addEventListener("click", () => {
          if (!state.currentUser) {
            showModal("login");
            return;
          }
          if (state.cart.length === 0) {
            alert("Your cart is empty!");
            return;
          }
          showCheckoutModal();
        });
        
        dom.continueShoppingBtn.addEventListener("click", () =>
          showPage("products")
        );

        // Checkout modal buttons
        if (dom.proceedToPaymentBtn) {
          dom.proceedToPaymentBtn.addEventListener("click", proceedToPayment);
        }
        
        if (dom.checkoutCancelBtn) {
          dom.checkoutCancelBtn.addEventListener("click", () =>
            hideModal("checkout")
          );
        }

        // Online payment modal buttons
        if (dom.backToCheckoutBtn) {
          dom.backToCheckoutBtn.addEventListener("click", () => {
            hideModal("onlinePayment");
            showModal("checkout");
          });
        }
        
        if (dom.confirmPaymentBtn) {
          dom.confirmPaymentBtn.addEventListener("click", confirmOnlinePayment);
        }

        // Payment method selection
        if (dom.codPaymentOption) {
          dom.codPaymentOption.addEventListener("click", () => {
            document.getElementById("codPayment").checked = true;
            updatePaymentMethodSelection();
          });
        }
        
        if (dom.onlinePaymentOption) {
          dom.onlinePaymentOption.addEventListener("click", () => {
            document.getElementById("onlinePayment").checked = true;
            updatePaymentMethodSelection();
          });
        }

        // Refunds button in navbar
        if (dom.refundsBtn)
          dom.refundsBtn.addEventListener("click", () => {
            if (!state.currentUser) {
              showModal("login");
              return;
            }
            showPage("refunds");
            renderOrdersPage();
          });

        // Refund modal wiring
        const closeRefundModal = document.getElementById("closeRefundModal");
        if (closeRefundModal)
          closeRefundModal.addEventListener("click", () => hideModal("refund"));
        if (dom.refundCancelBtn)
          dom.refundCancelBtn.addEventListener("click", () =>
            hideModal("refund")
          );
        if (dom.refundSubmitBtn)
          dom.refundSubmitBtn.addEventListener("click", submitRefundRequest);

        // Dashboard sidebar
        dom.sidebarItems.forEach((item) => {
          item.addEventListener("click", () => {
            const dashboardView = item.getAttribute("data-dashboard");
            loadDashboardView(dashboardView);

            // Update active class
            dom.sidebarItems.forEach((i) => i.classList.remove("active"));
            item.classList.add("active");
          });
        });

        // Close modals when clicking outside
        window.addEventListener("click", (e) => {
          if (e.target === dom.loginModal) hideModal("login");
          if (e.target === dom.signupModal) hideModal("signup");
          if (e.target === dom.addProductModal) hideModal("addProduct");
          if (dom.checkoutModal && e.target === dom.checkoutModal)
            hideModal("checkout");
          if (dom.onlinePaymentModal && e.target === dom.onlinePaymentModal)
            hideModal("onlinePayment");
          if (dom.refundModal && e.target === dom.refundModal)
            hideModal("refund");
        });
      }

      // Page Navigation
      function showPage(pageId) {
        // Hide all pages
        dom.pages.forEach((page) => page.classList.add("hidden"));

        // Show selected page
        const page = document.getElementById(pageId);
        if (page) {
          page.classList.remove("hidden");

          // Update active nav item
          dom.navItems.forEach((item) => {
            if (item.getAttribute("data-page") === pageId) {
              item.style.color = "#4a6cf7";
            } else {
              item.style.color = "";
            }
          });

          // Load page-specific content
          if (pageId === "cart") {
            renderCart();
          } else if (pageId === "sellerDashboard") {
            loadDashboardView("overview");
          }
        }
      }

      // Modal Controls
      function showModal(modalName) {
        hideAllModals();

        if (modalName === "login") {
          dom.loginModal.classList.remove("hidden");
          renderAvailableAccounts();
        } else if (modalName === "signup") {
          dom.signupModal.classList.remove("hidden");
        } else if (modalName === "addProduct") {
          const role = state.currentUser
            ? state.currentUser.activeRole || state.currentUser.type
            : null;
          if (state.currentUser && role === "seller") {
            dom.addProductModal.classList.remove("hidden");
          }
        } else if (modalName === "checkout") {
          if (dom.checkoutModal) {
            dom.checkoutModal.classList.remove("hidden");
            updateCheckoutSummary();
          }
        } else if (modalName === "onlinePayment") {
          if (dom.onlinePaymentModal) {
            dom.onlinePaymentModal.classList.remove("hidden");
            updateOnlinePaymentSummary();
          }
        } else if (modalName === "refund") {
          if (dom.refundModal) dom.refundModal.classList.remove("hidden");
        }
      }

      function showCheckoutModal() {
        // Reset form
        document.getElementById("deliveryFullName").value = "";
        document.getElementById("deliveryPhone").value = "";
        document.getElementById("deliveryAddress").value = "";
        document.getElementById("deliveryCity").value = "";
        document.getElementById("deliveryZipCode").value = "";
        
        // Set default payment method
        document.getElementById("codPayment").checked = true;
        updatePaymentMethodSelection();
        
        // Show modal
        showModal("checkout");
      }

      function updatePaymentMethodSelection() {
        const codOption = document.getElementById("codPaymentOption");
        const onlineOption = document.getElementById("onlinePaymentOption");
        
        if (document.getElementById("codPayment").checked) {
          codOption.classList.add("active");
          onlineOption.classList.remove("active");
        } else {
          codOption.classList.remove("active");
          onlineOption.classList.add("active");
        }
      }

      function renderAvailableAccounts() {
        const accountsList = document.getElementById("availableAccountsList");
        if (!accountsList) return;
        accountsList.innerHTML = "";

        state.users.forEach((user) => {
          const card = document.createElement("div");
          card.style.cssText =
            "padding:12px;border:1px solid #ddd;border-radius:6px;cursor:pointer;text-align:center;transition:all 0.3s;background:#f8f9fa";
          card.innerHTML = `<div style="font-weight:600;font-size:14px">${user.name}</div><div style="font-size:12px;color:#666">${user.email}</div><div style="font-size:11px;color:#999;margin-top:4px">${user.type}</div>`;
          card.addEventListener("mouseenter", () => {
            card.style.background = "#e3e9ff";
            card.style.borderColor = "#4a6cf7";
          });
          card.addEventListener("mouseleave", () => {
            card.style.background = "#f8f9fa";
            card.style.borderColor = "#ddd";
          });
          card.addEventListener("click", () => {
            document.getElementById("loginEmail").value = user.email;
            document.getElementById("loginPassword").value = user.password;
            selectUserType(user.type);
          });
          accountsList.appendChild(card);
        });
      }

      function hideModal(modalName) {
        if (modalName === "login") {
          dom.loginModal.classList.add("hidden");
        } else if (modalName === "signup") {
          dom.signupModal.classList.add("hidden");
        } else if (modalName === "addProduct") {
          dom.addProductModal.classList.add("hidden");
        } else if (modalName === "checkout") {
          dom.checkoutModal.classList.add("hidden");
        } else if (modalName === "onlinePayment") {
          dom.onlinePaymentModal.classList.add("hidden");
        }
      }

      function hideAllModals() {
        dom.loginModal.classList.add("hidden");
        dom.signupModal.classList.add("hidden");
        dom.addProductModal.classList.add("hidden");
        if (dom.checkoutModal) dom.checkoutModal.classList.add("hidden");
        if (dom.onlinePaymentModal) dom.onlinePaymentModal.classList.add("hidden");
        if (dom.refundModal) dom.refundModal.classList.add("hidden");
      }

      // User Type Selection
      function selectUserType(userType) {
        // Update active state in login modal
        const loginOptions =
          dom.loginModal.querySelectorAll(".user-type-option");
        loginOptions.forEach((option) => {
          if (option.getAttribute("data-user-type") === userType) {
            option.classList.add("active");
          } else {
            option.classList.remove("active");
          }
        });

        // Update active state in signup modal
        const signupOptions =
          dom.signupModal.querySelectorAll(".user-type-option");
        signupOptions.forEach((option) => {
          if (option.getAttribute("data-user-type") === userType) {
            option.classList.add("active");
          } else {
            option.classList.remove("active");
          }
        });
      }

      // Authentication Functions
      function handleLogin(e) {
        e.preventDefault();

        const email = document.getElementById("loginEmail").value;
        const password = document.getElementById("loginPassword").value;
        const userType = dom.loginModal
          .querySelector(".user-type-option.active")
          .getAttribute("data-user-type");

        // Find user
        const user = state.users.find(
          (u) =>
            u.email === email && u.password === password && u.type === userType
        );

        if (user) {
          // Successful login
          // preserve activeRole if previously set, otherwise default to user.type
          const activeRole = user.activeRole || user.type;
          state.currentUser = { ...user, activeRole };
          saveUserToStorage();
          updateUIAfterLogin();
          hideModal("login");

          // Show success message
          alert(`Welcome back, ${user.name}!`);

          // Redirect based on active role
          if (activeRole === "seller") {
            showPage("sellerDashboard");
          } else {
            showPage("products");
          }
        } else {
          alert("Invalid email, password, or user type. Please try again.");
        }
      }

      function handleSignup(e) {
        e.preventDefault();

        const name = document.getElementById("signupName").value;
        const email = document.getElementById("signupEmail").value;
        const password = document.getElementById("signupPassword").value;
        const confirmPassword =
          document.getElementById("confirmPassword").value;
        const userType = dom.signupModal
          .querySelector(".user-type-option.active")
          .getAttribute("data-user-type");

        // Validation
        if (password !== confirmPassword) {
          alert("Passwords do not match!");
          return;
        }

        if (password.length < 6) {
          alert("Password must be at least 6 characters long!");
          return;
        }

        // Check if user already exists
        const userExists = state.users.some((u) => u.email === email);
        if (userExists) {
          alert("User with this email already exists!");
          return;
        }

        // Create new user
        const newUser = {
          id: state.users.length + 1,
          name: name,
          email: email,
          password: password,
          type: userType,
          activeRole: userType,
        };

        state.users.push(newUser);
        state.currentUser = { ...newUser };
        saveUserToStorage();
        updateUIAfterLogin();
        hideModal("signup");

        // Show success message
        alert(`Account created successfully! Welcome to ShopEasy, ${name}!`);

        // Redirect based on user type
        if (userType === "seller") {
          showPage("sellerDashboard");
        } else {
          showPage("products");
        }
      }

      function logout() {
        state.currentUser = null;
        localStorage.removeItem("shopeasy_user");
        updateUIAfterLogout();
        showPage("home");
        alert("You have been logged out successfully.");
      }

      function updateUIAfterLogin() {
        dom.loginBtn.classList.add("hidden");
        dom.logoutBtn.classList.remove("hidden");
        if (dom.refundsBtn) dom.refundsBtn.classList.remove("hidden");
        dom.userInfo.classList.remove("hidden");
        dom.userName.textContent = state.currentUser.name;
        dom.userAvatar.textContent = state.currentUser.name
          .charAt(0)
          .toUpperCase();

        // Update cart icon based on activeRole (user can act as buyer or seller)
        const role = state.currentUser.activeRole || state.currentUser.type;
        if (role === "buyer") dom.cartIcon.style.display = "block";
        else dom.cartIcon.style.display = "none";

        // Load user's cart from storage and re-render products so purchase buttons appear
        loadCartFromStorage();
        renderProducts();
        updateCartDisplay();
      }

      function updateUIAfterLogout() {
        dom.loginBtn.classList.remove("hidden");
        dom.logoutBtn.classList.add("hidden");
        if (dom.refundsBtn) dom.refundsBtn.classList.add("hidden");
        dom.userInfo.classList.add("hidden");
        dom.cartIcon.style.display = "block";

        // Clear cart when logging out
        state.cart = [];
        updateCartDisplay();

        // Reset account switcher selection
        if (dom.accountSwitch) {
          dom.accountSwitch.value = "";
        }
      }

      function loadUserFromStorage() {
        const savedUser = localStorage.getItem("shopeasy_user");
        if (savedUser) {
          state.currentUser = JSON.parse(savedUser);
          updateUIAfterLogin();
        }
      }

      function saveUserToStorage() {
        if (state.currentUser) {
          localStorage.setItem(
            "shopeasy_user",
            JSON.stringify(state.currentUser)
          );
        }
      }

      // Product Functions
      function renderFeaturedProducts() {
        const featured = state.products.slice(0, 3); // First 3 products as featured
        dom.featuredProducts.innerHTML = "";

        featured.forEach((product) => {
          const productCard = createProductCard(product);
          dom.featuredProducts.appendChild(productCard);
        });
      }

      function renderCategories() {
        dom.categoryFilter.innerHTML = "";

        state.categories.forEach((category) => {
          const button = document.createElement("button");
          button.className = `category-btn ${
            category === "all" ? "active" : ""
          }`;
          button.textContent =
            category === "all"
              ? "All Products"
              : category.charAt(0).toUpperCase() + category.slice(1);
          button.setAttribute("data-category", category);

          button.addEventListener("click", () => {
            // Update active button
            document
              .querySelectorAll(".category-btn")
              .forEach((btn) => btn.classList.remove("active"));
            button.classList.add("active");

            // Filter products
            filterProductsByCategory(category);
          });

          dom.categoryFilter.appendChild(button);
        });
      }

      function renderProducts() {
        dom.productsGrid.innerHTML = "";

        state.products.forEach((product) => {
          const productCard = createProductCard(product);
          dom.productsGrid.appendChild(productCard);
        });
      }

      function createProductCard(product) {
        const card = document.createElement("div");
        card.className = "product-card";
        card.setAttribute("data-id", product.id);

        // Show Add to Cart for any logged-in user. If seller owns the product, also show Delete.
        card.innerHTML = `
                <img src="${product.image}" alt="${
          product.name
        }" class="product-image">
                <div class="product-info">
                    <h3 class="product-title">${product.name}</h3>
                    <p class="product-description">${product.description}</p>
                    <p class="product-price">${formatRS(product.price)}</p>
                    <p class="product-seller">Sold by: ${product.seller}</p>
                    ${
                      state.currentUser
                        ? `<div style="display:flex;gap:10px;align-items:center;">
                            ${(() => {
                              const role =
                                state.currentUser.activeRole ||
                                state.currentUser.type;
                              if (role === "buyer") {
                                return `<button class="btn btn-primary add-to-cart-btn" data-id="${product.id}">Add to Cart</button>`;
                              }
                              return "";
                            })()}
                            ${
                              state.currentUser.type === "seller" &&
                              product.seller === state.currentUser.name
                                ? `<button class="btn btn-danger delete-product-btn" data-id="${product.id}">Delete</button>`
                                : ""
                            }
                        </div>`
                        : `<button class="btn btn-primary" onclick="showModal('login')">Login to Purchase</button>`
                    }
                </div>
            `;

        // Add event listeners for Add to Cart and Delete (if present)
        const addToCartBtn = card.querySelector(".add-to-cart-btn");
        if (addToCartBtn) {
          addToCartBtn.addEventListener("click", () => addToCart(product.id));
        }

        const deleteBtn = card.querySelector(".delete-product-btn");
        if (deleteBtn) {
          deleteBtn.addEventListener("click", () => deleteProduct(product.id));
        }

        return card;
      }

      function filterProductsByCategory(category) {
        const allProducts = document.querySelectorAll(".product-card");

        allProducts.forEach((card) => {
          const productId = parseInt(card.getAttribute("data-id"));
          const product = state.products.find((p) => p.id === productId);

          if (category === "all" || product.category === category) {
            card.style.display = "block";
          } else {
            card.style.display = "none";
          }
        });
      }

      function handleAddProduct(e) {
        e.preventDefault();

        const role = state.currentUser
          ? state.currentUser.activeRole || state.currentUser.type
          : null;
        if (!state.currentUser || role !== "seller") {
          alert("Only sellers (acting as seller) can add products!");
          return;
        }

        const product = {
          id: state.products.length + 1,
          name: document.getElementById("productName").value,
          description: document.getElementById("productDescription").value,
          price: parseFloat(document.getElementById("productPrice").value),
          category: document.getElementById("productCategory").value,
          image: document.getElementById("productImage").value,
          seller: state.currentUser.name,
        };

        state.products.push(product);
        renderProducts();
        hideModal("addProduct");
        document.getElementById("addProductForm").reset();

        // Show success message
        alert("Product added successfully!");

        // Refresh the products view if we're on the seller dashboard
        if (
          document
            .getElementById("sellerDashboard")
            .classList.contains("hidden") === false
        ) {
          loadDashboardView("products");
        }
      }

      function deleteProduct(productId) {
        const role = state.currentUser
          ? state.currentUser.activeRole || state.currentUser.type
          : null;
        if (!state.currentUser || role !== "seller") {
          alert("Only sellers (acting as seller) can delete products!");
          return;
        }

        const product = state.products.find((p) => p.id === productId);
        if (!product) return;

        if (product.seller !== state.currentUser.name) {
          alert("You can only delete your own products!");
          return;
        }

        state.products = state.products.filter((p) => p.id !== productId);
        renderProducts();
        alert("Product deleted successfully!");

        if (
          document.getElementById("sellerDashboard") &&
          !document
            .getElementById("sellerDashboard")
            .classList.contains("hidden")
        ) {
          loadDashboardView("products");
        }
      }

      function updateCartDisplay() {
        // Update cart count
        const totalItems = state.cart.reduce(
          (sum, item) => sum + item.quantity,
          0
        );
        dom.cartCount.textContent = totalItems;

        // Save cart to localStorage
        if (state.currentUser) {
          localStorage.setItem(
            `shopeasy_cart_${state.currentUser.id}`,
            JSON.stringify(state.cart)
          );
        }
      }

      function renderCart() {
        if (state.cart.length === 0) {
          dom.cartItems.innerHTML =
            '<p style="text-align: center; padding: 40px;">Your cart is empty</p>';
          updateCartSummary();
          return;
        }

        dom.cartItems.innerHTML = "";

        state.cart.forEach((item) => {
          const cartItem = document.createElement("div");
          cartItem.className = "cart-item";
          cartItem.innerHTML = `
                    <img src="${item.image}" alt="${
            item.name
          }" class="cart-item-image">
                    <div class="cart-item-details">
                        <h3 class="cart-item-title">${item.name}</h3>
                        <p class="cart-item-price">${formatRS(item.price)}</p>
                        <div class="cart-item-actions">
                            <div class="quantity-control">
                                <button class="quantity-btn decrease-btn" data-id="${
                                  item.id
                                }">-</button>
                                <span class="quantity">${item.quantity}</span>
                                <button class="quantity-btn increase-btn" data-id="${
                                  item.id
                                }">+</button>
                            </div>
                            <button class="btn btn-danger remove-btn" data-id="${
                              item.id
                            }">Remove</button>
                        </div>
                    </div>
                `;

          dom.cartItems.appendChild(cartItem);
        });

        // Add event listeners to cart buttons
        dom.cartItems.querySelectorAll(".decrease-btn").forEach((btn) => {
          btn.addEventListener("click", () => {
            const productId = parseInt(btn.getAttribute("data-id"));
            updateCartItemQuantity(productId, -1);
          });
        });

        dom.cartItems.querySelectorAll(".increase-btn").forEach((btn) => {
          btn.addEventListener("click", () => {
            const productId = parseInt(btn.getAttribute("data-id"));
            updateCartItemQuantity(productId, 1);
          });
        });

        dom.cartItems.querySelectorAll(".remove-btn").forEach((btn) => {
          btn.addEventListener("click", () => {
            const productId = parseInt(btn.getAttribute("data-id"));
            removeFromCart(productId);
          });
        });

        updateCartSummary();
      }

      function updateCartItemQuantity(productId, change) {
        const item = state.cart.find((item) => item.id === productId);
        if (!item) return;

        item.quantity += change;

        if (item.quantity <= 0) {
          removeFromCart(productId);
        } else {
          updateCartDisplay();
          renderCart();
        }
      }

      function addToCart(productId) {
        if (!state.currentUser) {
          alert("Please login to add items to cart");
          showModal("login");
          return;
        }

        const role = state.currentUser.activeRole || state.currentUser.type;
        if (role !== "buyer") {
          alert("Switch to buyer role to add items to cart");
          return;
        }

        const product = state.products.find((p) => p.id === productId);
        if (!product) return;

        const existingItem = state.cart.find((item) => item.id === productId);

        if (existingItem) {
          existingItem.quantity += 1;
        } else {
          state.cart.push({
            ...product,
            quantity: 1,
          });
        }

        updateCartDisplay();
        alert(`${product.name} added to cart!`);
      }

      function removeFromCart(productId) {
        state.cart = state.cart.filter((item) => item.id !== productId);
        updateCartDisplay();
        renderCart();
      }

      function updateCartSummary() {
        const subtotal = state.cart.reduce(
          (sum, item) => sum + item.price * item.quantity,
          0
        );
        const shipping = subtotal > 0 ? 5.0 : 0;
        const tax = subtotal * 0.1; // 10% tax
        const total = subtotal + shipping + tax;

        // Save last totals (in USD) for checkout logic
        window.lastCartTotals = { subtotal, shipping, tax, total };

        dom.cartSubtotal.textContent = formatRS(subtotal);
        dom.cartShipping.textContent = formatRS(shipping);
        dom.cartTax.textContent = formatRS(tax);
        dom.cartTotal.textContent = formatRS(total);
      }

      function updateCheckoutSummary() {
        const totals = window.lastCartTotals || {
          subtotal: 0,
          shipping: 0,
          tax: 0,
          total: 0,
        };

        document.getElementById("checkoutSubtotal").textContent = formatRS(totals.subtotal);
        document.getElementById("checkoutShipping").textContent = formatRS(totals.shipping);
        document.getElementById("checkoutTax").textContent = formatRS(totals.tax);
        document.getElementById("checkoutTotal").textContent = formatRS(totals.total);
      }

      function updateOnlinePaymentSummary() {
        const totals = window.lastCartTotals || {
          subtotal: 0,
          shipping: 0,
          tax: 0,
          total: 0,
        };

        document.getElementById("paymentSubtotal").textContent = formatRS(totals.subtotal);
        document.getElementById("paymentShipping").textContent = formatRS(totals.shipping);
        document.getElementById("paymentTax").textContent = formatRS(totals.tax);
        document.getElementById("paymentTotal").textContent = formatRS(totals.total);
      }

      function proceedToPayment() {
        // Validate delivery information
        const fullName = document.getElementById("deliveryFullName").value.trim();
        const phone = document.getElementById("deliveryPhone").value.trim();
        const address = document.getElementById("deliveryAddress").value.trim();
        const city = document.getElementById("deliveryCity").value.trim();
        const zipCode = document.getElementById("deliveryZipCode").value.trim();

        if (!fullName || !phone || !address || !city || !zipCode) {
          alert("Please fill in all delivery information fields.");
          return;
        }

        // Validate phone number (simple validation)
        if (phone.length < 10) {
          alert("Please enter a valid phone number.");
          return;
        }

        // Get selected payment method
        const paymentMethod = document.querySelector('input[name="paymentMethod"]:checked').value;

        // Store delivery information for later use
        window.deliveryInfo = {
          fullName,
          phone,
          address,
          city,
          zipCode,
          paymentMethod
        };

        if (paymentMethod === "online") {
          // Show online payment modal
          hideModal("checkout");
          showModal("onlinePayment");
        } else {
          // Process Cash on Delivery
          processCashOnDelivery();
        }
      }

      function processCashOnDelivery() {
        const deliveryInfo = window.deliveryInfo;
        const totals = window.lastCartTotals || { total: 0 };

        // Create order
        const order = {
          id: Date.now(),
          items: state.cart.map(item => ({
            id: item.id,
            name: item.name,
            price: item.price,
            quantity: item.quantity,
          })),
          totals: window.lastCartTotals,
          deliveryInfo: deliveryInfo,
          paymentMethod: "cash_on_delivery",
          status: "pending",
          createdAt: new Date().toISOString(),
        };

        // Save order
        saveOrder(order);

        // Show success message
        alert(`‚úÖ Order placed successfully!\n\nOrder #${order.id}\nTotal: ${formatRS(totals.total)}\nPayment: Cash on Delivery\n\nYour order will be delivered to:\n${deliveryInfo.fullName}\n${deliveryInfo.address}\n${deliveryInfo.city}, ${deliveryInfo.zipCode}\nPhone: ${deliveryInfo.phone}\n\nOur delivery agent will contact you before delivery.`);

        // Clear cart and close modal
        state.cart = [];
        updateCartDisplay();
        hideModal("checkout");
        renderCart();
        showPage("products");
      }

      function confirmOnlinePayment() {
        // Validate card information
        const cardNumber = document.getElementById("cardNumber").value.trim();
        const cardExpiry = document.getElementById("cardExpiry").value.trim();
        const cardCVV = document.getElementById("cardCVV").value.trim();
        const cardName = document.getElementById("cardName").value.trim();
        const billingAddress = document.getElementById("billingAddress").value.trim();
        const billingCity = document.getElementById("billingCity").value.trim();
        const billingZipCode = document.getElementById("billingZipCode").value.trim();

        // Simple validation
        if (!cardNumber || !cardExpiry || !cardCVV || !cardName || !billingAddress || !billingCity || !billingZipCode) {
          alert("Please fill in all payment information fields.");
          return;
        }

        // Validate card number (simple Luhn check)
        if (!validateCardNumber(cardNumber.replace(/\s/g, ''))) {
          alert("Please enter a valid card number.");
          return;
        }

        // Validate expiry date
        if (!validateExpiryDate(cardExpiry)) {
          alert("Please enter a valid expiry date (MM/YY).");
          return;
        }

        // Validate CVV
        if (cardCVV.length < 3 || cardCVV.length > 4) {
          alert("Please enter a valid CVV (3-4 digits).");
          return;
        }

        const deliveryInfo = window.deliveryInfo;
        const totals = window.lastCartTotals || { total: 0 };

        // Create order
        const order = {
          id: Date.now(),
          items: state.cart.map(item => ({
            id: item.id,
            name: item.name,
            price: item.price,
            quantity: item.quantity,
          })),
          totals: window.lastCartTotals,
          deliveryInfo: deliveryInfo,
          paymentMethod: "online",
          paymentDetails: {
            lastFour: cardNumber.slice(-4),
            cardType: getCardType(cardNumber)
          },
          status: "paid",
          createdAt: new Date().toISOString(),
        };

        // Save order
        saveOrder(order);

        // Show success message
        alert(`‚úÖ Payment Successful!\n\nOrder #${order.id}\nAmount: ${formatRS(totals.total)}\nPayment Method: Online (Card ending in ${cardNumber.slice(-4)})\n\nYour order will be delivered to:\n${deliveryInfo.fullName}\n${deliveryInfo.address}\n${deliveryInfo.city}, ${deliveryInfo.zipCode}\nPhone: ${deliveryInfo.phone}\n\nThank you for your purchase!`);

        // Clear cart and close modal
        state.cart = [];
        updateCartDisplay();
        hideModal("onlinePayment");
        renderCart();
        showPage("products");
      }

      function validateCardNumber(cardNumber) {
        // Simple validation - in real app, use proper validation
        const cleaned = cardNumber.replace(/\D/g, '');
        return cleaned.length >= 13 && cleaned.length <= 19;
      }

      function validateExpiryDate(expiry) {
        const [month, year] = expiry.split('/');
        if (!month || !year || month.length !== 2 || year.length !== 2) {
          return false;
        }
        
        const currentYear = new Date().getFullYear() % 100;
        const currentMonth = new Date().getMonth() + 1;
        
        const expMonth = parseInt(month);
        const expYear = parseInt(year);
        
        if (expMonth < 1 || expMonth > 12) return false;
        if (expYear < currentYear) return false;
        if (expYear === currentYear && expMonth < currentMonth) return false;
        
        return true;
      }

      function getCardType(cardNumber) {
        const cleaned = cardNumber.replace(/\D/g, '');
        if (/^4/.test(cleaned)) return "Visa";
        if (/^5[1-5]/.test(cleaned)) return "MasterCard";
        if (/^3[47]/.test(cleaned)) return "American Express";
        if (/^6(?:011|5)/.test(cleaned)) return "Discover";
        return "Credit Card";
      }

      function saveOrder(order) {
        if (!state.currentUser) return;
        
        const ordersKey = `shopeasy_orders_${state.currentUser.id}`;
        const existing = JSON.parse(localStorage.getItem(ordersKey) || "[]");
        existing.push(order);
        localStorage.setItem(ordersKey, JSON.stringify(existing));
      }

      // Load cart from localStorage
      function loadCartFromStorage() {
        if (state.currentUser) {
          const savedCart = localStorage.getItem(
            `shopeasy_cart_${state.currentUser.id}`
          );
          if (savedCart) {
            state.cart = JSON.parse(savedCart);
            updateCartDisplay();
          }
        }
      }

      // Orders: save/load and render
      function loadOrdersForCurrentUser() {
        if (!state.currentUser) return [];
        const ordersKey = `shopeasy_orders_${state.currentUser.id}`;
        return JSON.parse(localStorage.getItem(ordersKey) || "[]");
      }

      function saveOrdersForCurrentUser(orders) {
        if (!state.currentUser) return;
        const ordersKey = `shopeasy_orders_${state.currentUser.id}`;
        localStorage.setItem(ordersKey, JSON.stringify(orders));
      }

      function renderOrdersPage() {
        if (!dom.ordersList) return;
        const orders = loadOrdersForCurrentUser();
        if (!orders || orders.length === 0) {
          dom.ordersList.innerHTML =
            '<p style="text-align:center;padding:30px">No orders yet.</p>';
          return;
        }

        dom.ordersList.innerHTML = "";
        orders
          .slice()
          .reverse()
          .forEach((order) => {
            const container = document.createElement("div");
            container.style.borderBottom = "1px solid #eee";
            container.style.padding = "12px 0";
            container.innerHTML = `
            <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:12px">
              <div>
                <strong>Order #${order.id}</strong>
                <div style="font-size:13px;color:#666">${new Date(
                  order.createdAt
                ).toLocaleString()}</div>
                <div style="margin-top:8px">${order.items
                  .map((i) => `${i.name} x${i.quantity}`)
                  .join(", ")}</div>
                <div style="margin-top:8px;font-weight:600">Total: ${formatRS(
                  order.totals.total
                )}</div>
                <div style="font-size:13px;color:#666">Payment: ${
                  order.paymentMethod === "online"
                    ? "Online"
                    : "Cash on Delivery"
                } ‚Ä¢ Status: ${order.status}${
              order.refund && order.refund.status
                ? " ‚Ä¢ Refund: " + order.refund.status
                : ""
            }</div>
              </div>
              <div style="display:flex;flex-direction:column;gap:8px;align-items:flex-end">
                ${
                  order.refund && order.refund.status
                    ? `<button class="btn btn-outline" disabled>Refund Requested</button>`
                    : `<button class="btn btn-primary request-refund-btn" data-order="${order.id}">Request Refund</button>`
                }
              </div>
            </div>
          `;
            dom.ordersList.appendChild(container);
          });

        // wire refund buttons
        dom.ordersList
          .querySelectorAll(".request-refund-btn")
          .forEach((btn) => {
            btn.addEventListener("click", () => {
              const orderId = parseInt(btn.getAttribute("data-order"));
              // store current pending refund order id on dom for submission
              dom._pendingRefundOrderId = orderId;
              if (dom.refundReason) dom.refundReason.value = "";
              showModal("refund");
            });
          });
      }

      function submitRefundRequest() {
        const reason = (dom.refundReason && dom.refundReason.value) || "";
        const orderId = dom._pendingRefundOrderId;
        if (!reason) {
          alert("Please describe the reason for refund.");
          return;
        }
        const orders = loadOrdersForCurrentUser();
        const idx = orders.findIndex((o) => o.id === orderId);
        if (idx === -1) {
          alert("Order not found");
          hideModal("refund");
          return;
        }
        orders[idx].refund = {
          reason,
          status: "requested",
          requestedAt: new Date().toISOString(),
        };
        saveOrdersForCurrentUser(orders);
        hideModal("refund");
        alert("Refund request submitted. Seller will review your request.");
        renderOrdersPage();
      }

      // Account switcher: populate dropdown with available users + logout option
      function renderAccountPageOptions() {
        const sel = document.getElementById("accountPageSelect");
        if (!sel) return;
        sel.innerHTML = "";
        const placeholder = document.createElement("option");
        placeholder.value = "";
        placeholder.textContent = "Choose an account to switch to";
        sel.appendChild(placeholder);
        state.users.forEach((u) => {
          const opt = document.createElement("option");
          opt.value = u.id;
          opt.textContent = `${u.name} (${u.type})`;
          sel.appendChild(opt);
        });
        const logoutOpt = document.createElement("option");
        logoutOpt.value = "logout";
        logoutOpt.textContent = "Log out (clear session)";
        sel.appendChild(logoutOpt);
        // preselect current if present
        if (state.currentUser) sel.value = state.currentUser.id;
        else sel.value = "";
        // set role radios based on currentUser activeRole or type
        const active =
          (state.currentUser && state.currentUser.activeRole) ||
          (state.currentUser && state.currentUser.type) ||
          "";
        const radios = document.getElementsByName("accountRole");
        radios.forEach((r) => {
          if (r.value === active) r.checked = true;
          else r.checked = false;
        });
      }

      function setupAccountPageListeners() {
        if (!dom.applySwitchBtn || !dom.cancelSwitchBtn) {
          dom.applySwitchBtn = document.getElementById("applySwitchBtn");
          dom.cancelSwitchBtn = document.getElementById("cancelSwitchBtn");
        }
        if (dom.cancelSwitchBtn)
          dom.cancelSwitchBtn.addEventListener("click", () => showPage("home"));
        if (dom.applySwitchBtn)
          dom.applySwitchBtn.addEventListener("click", () => {
            const sel = document.getElementById("accountPageSelect");
            if (!sel) return;
            const val = sel.value;
            if (!val) return alert("Please choose an account or logout.");
            if (val === "logout") {
              logout();
              showPage("home");
              return;
            }
            const id = parseInt(val, 10);
            const user = state.users.find((u) => u.id === id);
            if (!user) return alert("Selected user not found");
            // pick role from radios
            const roleRadios = document.getElementsByName("accountRole");
            let chosen = null;
            roleRadios.forEach((r) => {
              if (r.checked) chosen = r.value;
            });
            if (!chosen) chosen = user.type;
            state.currentUser = { ...user, activeRole: chosen };
            saveUserToStorage();
            loadCartFromStorage();
            updateUIAfterLogin();
            renderProducts();
            alert(`Now using ${user.name} as ${chosen}`);
            if (chosen === "seller") showPage("sellerDashboard");
            else showPage("products");
          });
      }

      // Dashboard Functions
      function loadDashboardView(view) {
        const role = state.currentUser
          ? state.currentUser.activeRole || state.currentUser.type
          : null;
        if (!state.currentUser || role !== "seller") {
          return;
        }

        let content = "";

        switch (view) {
          case "overview":
            const sellerProducts = state.products.filter(
              (p) => p.seller === state.currentUser.name
            );
            const totalSales = sellerProducts.reduce(
              (sum, p) => sum + p.price,
              0
            );

            content = `
                        <h2>Overview</h2>
                        <p>Welcome to your seller dashboard, ${
                          state.currentUser.name
                        }!</p>

                        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 30px;">
                            <div style="background: #f0f2ff; padding: 20px; border-radius: 10px;">
                                <h3 style="color: #4a6cf7;">${
                                  sellerProducts.length
                                }</h3>
                                <p>Total Products</p>
                            </div>
                            <div style="background: #f0f2ff; padding: 20px; border-radius: 10px;">
                                <h3 style="color: #4a6cf7;">${formatRS(
                                  totalSales
                                )}</h3>
                                <p>Total Sales Value</p>
                            </div>
                            <div style="background: #f0f2ff; padding: 20px; border-radius: 10px;">
                                <h3 style="color: #4a6cf7;">${Math.floor(
                                  totalSales / 50
                                )}</h3>
                                <p>Estimated Orders</p>
                            </div>
                        </div>
                    `;
            break;

          case "products":
            const myProducts = state.products.filter(
              (p) => p.seller === state.currentUser.name
            );

            content = `
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h2>My Products (${myProducts.length})</h2>
                            <button class="btn btn-success" id="addProductBtn">Add New Product</button>
                        </div>

                        ${
                          myProducts.length === 0
                            ? '<p>You haven\'t added any products yet. Click "Add New Product" to get started!</p>'
                            : '<div class="products-grid">' +
                              myProducts
                                .map(
                                  (product) => `
                                <div class="product-card">
                                    <img src="${product.image}" alt="${
                                    product.name
                                  }" class="product-image">
                                    <div class="product-info">
                                        <h3 class="product-title">${
                                          product.name
                                        }</h3>
                                        <p class="product-description">${
                                          product.description
                                        }</p>
                                        <p class="product-price">${formatRS(
                                          product.price
                                        )}</p>
                                        <button class="btn btn-danger delete-product-btn" data-id="${
                                          product.id
                                        }">Delete</button>
                                    </div>
                                </div>
                            `
                                )
                                .join("") +
                              "</div>"
                        }
                    `;
            break;

          case "addProduct":
            content = `
                        <h2>Add New Product</h2>
                        <p>Fill out the form below to add a new product to your store.</p>
                        <div style="background: #f8f9fa; padding: 30px; border-radius: 10px; margin-top: 20px;">
                            <form id="dashboardAddProductForm">
                                <div class="form-group">
                                    <label for="dashboardProductName">Product Name</label>
                                    <input type="text" id="dashboardProductName" required>
                                </div>
                                <div class="form-group">
                                    <label for="dashboardProductDescription">Description</label>
                                    <textarea id="dashboardProductDescription" rows="3" required></textarea>
                                </div>
                                <div class="form-group">
                                  <label for="dashboardProductPrice">Price (USD)</label>
                                  <input type="number" id="dashboardProductPrice" min="0" step="0.01" required>
                                </div>
                                <div class="form-group">
                                    <label for="dashboardProductCategory">Category</label>
                                    <select id="dashboardProductCategory" required>
                                        <option value="">Select Category</option>
                                        <option value="electronics">Electronics</option>
                                        <option value="fashion">Fashion</option>
                                        <option value="home">Home & Garden</option>
                                        <option value="sports">Sports</option>
                                        <option value="books">Books</option>
                                        <option value="other">Other</option>
                                    </select>
                                </div>
                                <div class="form-group">
                                    <label for="dashboardProductImage">Image URL</label>
                                    <input type="text" id="dashboardProductImage" placeholder="https://example.com/image.jpg" required>
                                </div>
                                <button type="submit" class="btn btn-success">Add Product</button>
                            </form>
                        </div>
                    `;
            break;

          case "orders":
            content = `
                        <h2>Orders</h2>
                        <p>View and manage your customer orders here.</p>
                        <div style="background: #f8f9fa; padding: 30px; border-radius: 10px; margin-top: 20px;">
                            <p style="text-align: center; color: #666;">Order management feature coming soon!</p>
                        </div>
                    `;
            break;

          case "analytics":
            content = `
                        <h2>Sales Analytics</h2>
                        <p>Track your sales performance and insights.</p>
                        <div style="background: #f8f9fa; padding: 30px; border-radius: 10px; margin-top: 20px;">
                            <p style="text-align: center; color: #666;">Analytics dashboard coming soon!</p>
                        </div>
                    `;
            break;
        }

        dom.dashboardContent.innerHTML = content;

        // Add event listeners for dynamic elements
        if (view === "products") {
          const addProductBtn = document.getElementById("addProductBtn");
          if (addProductBtn) {
            addProductBtn.addEventListener("click", () =>
              showModal("addProduct")
            );
          }

          // Add delete event listeners
          dom.dashboardContent
            .querySelectorAll(".delete-product-btn")
            .forEach((btn) => {
              btn.addEventListener("click", () => {
                const productId = parseInt(btn.getAttribute("data-id"));
                deleteProduct(productId);
              });
            });
        }

        if (view === "addProduct") {
          const form = document.getElementById("dashboardAddProductForm");
          if (form) {
            form.addEventListener("submit", (e) => {
              e.preventDefault();

              const product = {
                id: state.products.length + 1,
                name: document.getElementById("dashboardProductName").value,
                description: document.getElementById(
                  "dashboardProductDescription"
                ).value,
                price: parseFloat(
                  document.getElementById("dashboardProductPrice").value
                ),
                category: document.getElementById("dashboardProductCategory")
                  .value,
                image: document.getElementById("dashboardProductImage").value,
                seller: state.currentUser.name,
              };

              state.products.push(product);
              form.reset();
              loadDashboardView("products");

              alert("Product added successfully!");
            });
          }
        }
      }

      // Contact Form Handler
      function handleContact(e) {
        e.preventDefault();

        const name = document.getElementById("contactName").value;
        const email = document.getElementById("contactEmail").value;
        const subject = document.getElementById("contactSubject").value;
        const message = document.getElementById("contactMessage").value;

        
        alert(
          `Thank you for your message, ${name}! We have received your contact form submission and will get back to you at ${email} soon.`
        );

        // Reset form
        document.getElementById("contactForm").reset();

        // Note: In a real application, this would send an email to your Gmail
        // You would need a backend server with an API endpoint to handle email sending
        console.log("Contact form submission:", {
          name,
          email,
          subject,
          message,
        });
      }

      // Initialize the application when page loads
      window.addEventListener("DOMContentLoaded", init);

      // Load cart when user logs in
      if (state.currentUser) {
        loadCartFromStorage();
      }

      // Add auto-formatting for card number and expiry date
      document.addEventListener('DOMContentLoaded', function() {
        const cardNumberInput = document.getElementById('cardNumber');
        if (cardNumberInput) {
          cardNumberInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            value = value.replace(/(\d{4})/g, '$1 ').trim();
            e.target.value = value.substring(0, 19);
          });
        }

        const expiryInput = document.getElementById('cardExpiry');
        if (expiryInput) {
          expiryInput.addEventListener('input', function(e) {
            let value = e.target.value.replace(/\D/g, '');
            if (value.length >= 2) {
              value = value.substring(0, 2) + '/' + value.substring(2);
            }
            e.target.value = value.substring(0, 5);
          });
        }
      });
    </script>
  </body>
</html>